# Livepeer (LPT)

Livepeer는 이더리움 블록체인에 구축된 탈중앙화 비디오 코드 변환 네트워크이다.

완전히 탈중앙화되고 확장성이 높으며 암호화 토큰 인센티브가 있는 라이브 비디오 스트리밍 네트워크 프로토콜을 제공한다.

결과적으로 탈중앙화 개발 (Web3) 스택에서 라이브 미디어 계층 역할을 할 수 있는 솔루션을 제공한다. 


---


## 어떻게 동작하는가? 

비디오 개발의 기본 원칙은 원본 비디오를 인코딩 도구로 압축해서 전송 및 변경을 위한 파일 크기를 줄이는 것.

인코딩된 비디오는 이제 다른 변환으로 트랜스코딩되어야 한다. 

전통적인 웹에서는 중앙화된 서버에서 트랜스코딩이 이루어진다. 

라이브피어는 비디오 및 라이브스트림 데이터를 가져와 라이브피어 네트워크에서 트랜스코딩을 한다.


---


## CDN에 대해

CDN(컨텐츠 전송 네트워크)는 지리적으로 분산된 여러 개의 서버이다. 웹 컨텐츠를 사용자와 가까운 곳에서 전송함으로써 전송 속도를 높인다.

매일매일 폭발적으로 증가하는 데이터를 지연 없이 처리하기 위해서는 데이터를 분산해서 전달하는 기술이 필수적인데, 

지리적으로 먼 거리에 떨어져 있는 사용자에게 지연 없이 컨텐츠를 분산해 전달할 수 있는 CDN 서비스가 등장했다.

CDN은 각 지역에 캐시 서버를 분산 배치해, 근접한 사용자의 요청에 원본 서버가 아닌 캐시 서버(PoP, Points of presence)가 컨텐츠를 전달한다. 

예를 들어 미국에 있는 사용자가 한국에 호스팅 된 웹 사이트에 접근하는 경우, 미국에 위차한 PoP 서버에서 웹 사이트 컨텐츠를 사용자에게 전송하는 방식이다.

인터넷을 통해 비즈니스를 운영하거나 웹 사이트에서 그래픽 이미지, 동영상 파일 등의 컨텐츠를 제공한다면 CDN 서비스가 필요하다.

**특정 국가나 지연만을 타깃으로 하는 웹 서비스를 운영한다면 오히려 불필요한 연결 지점이 늘어나 웹 사이트의 성능 저하로 이어질 수 있다**


---


## RTMP/RTSP && HLS

> RTMP/RTSP : (Real Time Messaging Protocol/ Real Time Streaming Protocol)

> HLS : HTTP Live Streaming


우리가 스트리밍을 하게 되면 카메라가 촬영을 하게 되고, 이는 캡쳐 인터페이스를 통해 파일 생성으로 이어진다.

요즘은 카메라 자체적으로 바로 RTMP(Real Time Messaging Protocol) 신호와 같이 곧 바로 스트리밍 신호를 뽑아내는 기능을 가진 카메라도 있다. 

이럴 경우 중간 과정 없이 바로 파일이나 신호로 Output이 나오게 된다. 

신호형식이라는 표현을 사용한 이유는 서비스할 컨텐츠가 실시간인 경우에 해당한다. 

종류에 따라 HLS로 서비스 하는 경우 신호인 동시에 파일이기도 하다. 

HLS 기준으로 m3u8이라는 manifest file이 생성된다. 이 파일을 메모장으로 열어보면 몇 가지 태그와 함께

하위에 Chunk 파일 리스트가 보이게 된다. 즉, m3u8 파일은 그 내용이 계속 바뀌게 되고 Chunk라는 짧게 잘린 동영상 파일 목록이 갱신된다.


---


## Codec

코덱은 영상을 압축하기 위한 기술이다. 최대한 원본의 화질을 유지하면서 저용량 고화질의 서비스를 위해 영상을 압축하는 S/W이다.

코덱에는 여러 종류가 있고, 무료인 것이 있고 유료인 것이 있으며, 호환성도 따져봐야 함으로 잘 알아보고 사용하면 된다고 한다.


---


## Encoding vs Transcoding

인코딩은 압축 과정 자체를 의미한다. 예를 들어 압축되지 않은 무압축 영상을 코덱을 이용하여 압축하는 작업을 의미한다. 

카메라에서 촬영하면서 저장된 무압축 mp4 파일을 코덱을 통해 HD, FHD 등으로 해상도를 줄이면서 압축하는 작업이다. 

이 과정에서 중요한 점은 바로 어느 정도의 손실을 감수하고 화질을 줄일지 결정하는 부분이다. 

사실상 플랫폼 서비스를 위해서 인코딩과 동시에 트랜스코딩이 진행된다.

트랜스코딩은 영상 소스가 다른 형식으로 변환됨을 의미한다. 

주로 이 부분은 현업에서 RTMP가 원본인 영상을 고객에게 화질별로 서비스하기 위해서 SD, HD, FHD 이렇게 세 가지로 인코딩이 되고,

원본 1개가 각 화질로 서비스 파일이 인코딩 되는 동시에 DRM이 패키징된 다른 형식의 파일로 트랜스코딩하게 된다. 

AWS 이외 다른 솔루션들에서도 마찬가지로 변환되어 출력되는 결과물의 분당 과금으로 요금을 책정한다. 

물론 Live Streaming의 경우 input과 output 둘 다를 과금하는 형태도 있다. 

이 때 조심해야 하는 부분은 컨텐츠 변환 비용을 예측하기 위해 단순히 몇 분에 얼마라는 식으로 계산하면 안된다. 

어떠한 화질로 어떤 환경에서 어떤 디바이스에 서비스 할 지를 고려해야 한다. 

<br />

### 인코딩과 트랜스코딩의 차이

원본 영상파일 또는 신호를 1차적으로 인코딩을 통해 화질별로 압축하는 동시에 서비스 스펙에 맞는 파일 형태로 트랜스코딩 한다고 생각하면 된다. 

<br />

**인코딩** : 압축과정

**트랜스코딩** : 변환과정

> DRM : Digital Rights Management

---


## Source

[CDN이란 무엇인가?](https://www.akamai.com/ko/our-thinking/cdn/what-is-a-cdn)
[CDN](https://library.gabia.com/contents/infrahosting/8985/)
[영상 인코딩과 트랜스코딩](https://www.lonelyplanit.com/6)